pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

printh('debug started','debug',true)
function debug(s)
 printh(tostr(s),'debug',false)
end

poke(0x5f2d,3) -- NOTE: enable mouse

itemsperrow=10
swatchesoffx=32
swatchesoffy=2
colpalsoffx=60
colpalsoffy=2

function ispointinside(_px,_py,_x,_y,_w,_h)
 return _px >= _x and
  _px < _x+_w and
  _py >= _y and
  _py < _y+_h
end

--[[
0 - bg
1 - stroke
2 - dark fill
3 - medium fill
4 - light fill
--]]

function newswatch(_x,_y,_size,_color)
 return {
  x=_x,y=_y,
  size=_size,
  color=_color,
 }
end

swatches={
 newswatch(swatchesoffx+0,swatchesoffy+0,8,rnd({1,2,3,4,5,13})),
 newswatch(swatchesoffx+0,swatchesoffy+9,8,0),

 newswatch(swatchesoffx+1+8,swatchesoffy+0,8,5),
 newswatch(swatchesoffx+1+8,swatchesoffy+9,8,13),
 newswatch(swatchesoffx+1+8,swatchesoffy+18,8,6),
 newswatch(swatchesoffx+1+8,swatchesoffy+27,8,7),
}

colpals={}
for _i=0,15 do
 colpals[_i+1]={
  x=colpalsoffx+(_i%4)*7,
  y=colpalsoffy+flr(_i/4)*7,
  size=6,
  color=_i,
 }
end

function _draw()
 local _mx,_my=stat(32),stat(33)

 cls(0)

 pal({
  [0]=swatches[1].color,
  swatches[2].color,
  swatches[3].color,
  swatches[4].color,
  swatches[5].color,
  swatches[6].color,
 })

 rectfill(0,40,128,128,0)

 print('bg',swatchesoffx-9,4,10)
 print('strokes',swatchesoffx-25,13,10)

 for _i=0,65 do
  local _x,_y=_i%itemsperrow,flr(_i/itemsperrow)
  spr(_i,6+_x*12,44+_y*12)
 end

 pal()

 for _i=1,#swatches do
  local _swatch=swatches[_i]
  rect(
   _swatch.x-1,
   _swatch.y-1,
   _swatch.x+_swatch.size+1,
   _swatch.y+_swatch.size+1,
   1)
 end

 for _i=1,#swatches do
  local _swatch=swatches[_i]
  rectfill(
   _swatch.x,
   _swatch.y,
   _swatch.x+_swatch.size,
   _swatch.y+_swatch.size,
   _swatch.color)

   if _swatch.selected then
    rect(
     _swatch.x,
     _swatch.y,
     _swatch.x+_swatch.size,
     _swatch.y+_swatch.size,
     _swatch.color == 10 and 7 or 10)

     for _j=1,#colpals do
      local _colpal=colpals[_j]

      rectfill(
       _colpal.x,
       _colpal.y,
       _colpal.x+_colpal.size,
       _colpal.y+_colpal.size,
       _colpal.color)

      if _colpal.color == _swatch.color then
       rect(
        _colpal.x,
        _colpal.y,
        _colpal.x+_colpal.size,
        _colpal.y+_colpal.size,
        _colpal.color == 7 and 10 or 7)
      end

      if ispointinside(_mx,_my,_colpal.x,_colpal.y,_colpal.size,_colpal.size) then
       if btn() == 32 then
        _swatch.color=_colpal.color
       end

       rect(
       _colpal.x,
       _colpal.y,
       _colpal.x+_colpal.size,
       _colpal.y+_colpal.size,
       _colpal.color == 7 and 10 or 7)
      end
     end
   end

   if ispointinside(_mx,_my,_swatch.x,_swatch.y,_swatch.size,_swatch.size) then
    rect(
     _swatch.x,
     _swatch.y,
     _swatch.x+_swatch.size,
     _swatch.y+_swatch.size,
     _swatch.color == 7 and 10 or 7)
    if btn() == 32 then
     for _i=1,#swatches do
      swatches[_i].selected=nil
     end
     _swatch.selected=true
    end
   end
 end

 palt(0,true)
 spr(255,_mx,_my)
 palt(0,false)
 
end


__gfx__
00000111000001110000001100001011000000110000001100000011000001110000011100000111000001110000011100000111001111110111111000001000
00001441000014510000015100015151000001410000014100000141000014510000155100001551000015510000155100111551014444510144451000015100
00001541000014410000151000001510000015410000135100001531000012410001545111015451000155411101554111155541144444510144451000144310
00113210000123100001210000012141000151410001314100015141001121101115451013154510111554101315541013115410111444510131451001545341
01321100001313100013100000131010001513210013132100151321014210001354510013545100135541001355410013551410001314510131510000133310
01310000013101100131000001310000015132100131321001513210142310000135100001351000013410000134100001341110001215100121100001214100
13210000121000001210000012100000144421001454210014342100113100001213100012133100121310001213310012133100001211000121000013101000
11100000110000001100000011000000111110001111100011111000011000001101100011011100110110001101110011011100001310000131000011000000
00110000001111001111111111111111001111001111111111111111001111001111111111111111001001000010010000100100111001111110011100111100
01331000015544101555444115554441014433101444333114443331015433101544334115443341014113100151141001411310145114311531134101343210
13115100154433411544334115443341143322311433223114332231143322311433223114332231143432311545434114343231144323311443344113433221
12144310154543411545434115443341143532311435323114354231153432411434323114343231144323311554344114432331013432100135531014544431
12545341143443411434434115443341132342311323423114354231132332311523324115343241143432311545434114254131014323100135531011141111
13133310143333410143341014333341132222310132231013222231132222310132231013222231014323100154341001432310013432100124321000111110
13114100014444100014410001444410013333100013310001333310013343100013410001433410013432100145431001343210001321000015510000000000
13101000001111000001100000111100001111000001100000111100001111000001100000111100001111000011110000111100000110000001100000000000
00111100001111001111111111111111000000000011100000111000000000000000000001100110011001100110011001100110011001100110011000000000
01343210013432101343322113433221110110110141411001313110001111110000000001411410015115100151151001311310015115100151151000111100
13433221134332211343322113433221141541410131314101212131001414310011111115444451144554411445544115333351133553311335533100154100
14544331145443311454433114544331145544411141413111313121001414310013132114555531143443411434434113555521132332311323323101343210
11111131111411311111113111141131131111311354534112434231001515410014143114414431153443511523325113313321152332511534435113111121
14111321141113211411132114111321013343101344433112333221014144310131332114411431013443100134431013311321012332100123321013111121
14111321141113211411132114111321001111000134333101232221141443211313323114411431013443100134431013311321012332100123321001222210
01100110011001100111111001111110000000000015541000155410131332101414431014411431013443100134431013311321012332100123321000111100
00000000011111000111100001111000000100000000000001110000001111100111110000111100001111000000011100011100000000000111111000000000
00111100122222101222210012222100001510000011100015441000013333101415551001444410015555100000122100133210001110001155351100011000
01454310121111211211121012111210015541000144410014131000135554101115551014444441155555510001312101332221014441001554534100154100
14543321012133110124433101244331155444101455441014331000122224100015551013114111142252210014231001322221145243101455442100143110
14111121001354310014131100145351144333101455341001113100122324100015551013114111142252210153410011114111144233101344332101154431
13111121001344310001413100014331014331001433341000014310123224100015111101331331014424410145100013225100013331000132221015443541
01223210000133100001331000013310001410000144410000001431123324100011444100143410001545101211000001515100001110000122121014354431
00111100000011000000110000001100000100000011100000000111122221000001111000011100000111001100000001414100000000000012121000000000
00000000001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001321000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001100014443100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00115410001331000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01544310014433100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01435410145544310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000134444310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000013333100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057500000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057750000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057775000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057777500
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057755500
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055575000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055000
